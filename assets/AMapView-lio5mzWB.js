import{_ as C,r as m,z as S,A as j,B as V,a as k,u as z,b as E,m as O,o as P}from"./index-BlCAvboD.js";function J(M){return M&&M.__esModule&&Object.prototype.hasOwnProperty.call(M,"default")?M.default:M}var _={exports:{}},T=_.exports,B;function q(){return B||(B=1,(function(M,v){(function(g,c){M.exports=c()})(T,function(){function g(e){var s=[];return e.AMapUI&&s.push(c(e.AMapUI)),e.Loca&&s.push(w(e.Loca)),Promise.all(s)}function c(e){return new Promise(function(s,t){var i=[];if(e.plugins)for(var u=0;u<e.plugins.length;u+=1)n.AMapUI.plugins.indexOf(e.plugins[u])==-1&&i.push(e.plugins[u]);if(l.AMapUI===o.failed)t("前次请求 AMapUI 失败");else if(l.AMapUI===o.notload){l.AMapUI=o.loading,n.AMapUI.version=e.version||n.AMapUI.version,u=n.AMapUI.version;var f=document.body||document.head,d=document.createElement("script");d.type="text/javascript",d.src="https://webapi.amap.com/ui/"+u+"/main.js",d.onerror=function(r){l.AMapUI=o.failed,t("请求 AMapUI 失败")},d.onload=function(){if(l.AMapUI=o.loaded,i.length)window.AMapUI.loadUI(i,function(){for(var r=0,a=i.length;r<a;r++){var p=i[r].split("/").slice(-1)[0];window.AMapUI[p]=arguments[r]}for(s();A.AMapUI.length;)A.AMapUI.splice(0,1)[0]()});else for(s();A.AMapUI.length;)A.AMapUI.splice(0,1)[0]()},f.appendChild(d)}else l.AMapUI===o.loaded?e.version&&e.version!==n.AMapUI.version?t("不允许多个版本 AMapUI 混用"):i.length?window.AMapUI.loadUI(i,function(){for(var r=0,a=i.length;r<a;r++){var p=i[r].split("/").slice(-1)[0];window.AMapUI[p]=arguments[r]}s()}):s():e.version&&e.version!==n.AMapUI.version?t("不允许多个版本 AMapUI 混用"):A.AMapUI.push(function(r){r?t(r):i.length?window.AMapUI.loadUI(i,function(){for(var a=0,p=i.length;a<p;a++){var I=i[a].split("/").slice(-1)[0];window.AMapUI[I]=arguments[a]}s()}):s()})})}function w(e){return new Promise(function(s,t){if(l.Loca===o.failed)t("前次请求 Loca 失败");else if(l.Loca===o.notload){l.Loca=o.loading,n.Loca.version=e.version||n.Loca.version;var i=n.Loca.version,u=n.AMap.version.startsWith("2"),f=i.startsWith("2");if(u&&!f||!u&&f)t("JSAPI 与 Loca 版本不对应！！");else{u=n.key,f=document.body||document.head;var d=document.createElement("script");d.type="text/javascript",d.src="https://webapi.amap.com/loca?v="+i+"&key="+u,d.onerror=function(r){l.Loca=o.failed,t("请求 AMapUI 失败")},d.onload=function(){for(l.Loca=o.loaded,s();A.Loca.length;)A.Loca.splice(0,1)[0]()},f.appendChild(d)}}else l.Loca===o.loaded?e.version&&e.version!==n.Loca.version?t("不允许多个版本 Loca 混用"):s():e.version&&e.version!==n.Loca.version?t("不允许多个版本 Loca 混用"):A.Loca.push(function(r){r?t(r):t()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var o;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(o||(o={}));var n={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},l={AMap:o.notload,AMapUI:o.notload,Loca:o.notload},A={AMapUI:[],Loca:[]},y=[],b=function(e){typeof e=="function"&&(l.AMap===o.loaded?e(window.AMap):y.push(e))};return{load:function(e){return new Promise(function(s,t){if(l.AMap==o.failed)t("");else if(l.AMap==o.notload){var i=e.key,u=e.version,f=e.plugins;i?(window.AMap&&location.host!=="lbs.amap.com"&&t("禁止多种API加载方式混用"),n.key=i,n.AMap.version=u||n.AMap.version,n.AMap.plugins=f||n.AMap.plugins,l.AMap=o.loading,u=document.body||document.head,window.___onAPILoaded=function(r){if(delete window.___onAPILoaded,r)l.AMap=o.failed,t(r);else for(l.AMap=o.loaded,g(e).then(function(){s(window.AMap)}).catch(t);y.length;)y.splice(0,1)[0]()},f=document.createElement("script"),f.type="text/javascript",f.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+n.AMap.version+"&key="+i+"&plugin="+n.AMap.plugins.join(","),f.onerror=function(r){l.AMap=o.failed,t(r)},u.appendChild(f)):t("请填写key")}else if(l.AMap==o.loaded)if(e.key&&e.key!==n.key)t("多个不一致的 key");else if(e.version&&e.version!==n.AMap.version)t("不允许多个版本 JSAPI 混用");else{if(i=[],e.plugins)for(u=0;u<e.plugins.length;u+=1)n.AMap.plugins.indexOf(e.plugins[u])==-1&&i.push(e.plugins[u]);i.length?window.AMap.plugin(i,function(){g(e).then(function(){s(window.AMap)}).catch(t)}):g(e).then(function(){s(window.AMap)}).catch(t)}else if(e.key&&e.key!==n.key)t("多个不一致的 key");else if(e.version&&e.version!==n.AMap.version)t("不允许多个版本 JSAPI 混用");else{var d=[];if(e.plugins)for(u=0;u<e.plugins.length;u+=1)n.AMap.plugins.indexOf(e.plugins[u])==-1&&d.push(e.plugins[u]);b(function(){d.length?window.AMap.plugin(d,function(){g(e).then(function(){s(window.AMap)}).catch(t)}):g(e).then(function(){s(window.AMap)}).catch(t)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,n={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},l={AMap:o.notload,AMapUI:o.notload,Loca:o.notload},A={AMap:[],AMapUI:[],Loca:[]}}}})})(_)),_.exports}var D=q();const K=J(D),R={key:1,class:"map-placeholder"},W={__name:"AMapView",props:{points:{type:Array,default:()=>[]},path:{type:Array,default:()=>[]},showIndex:{type:Boolean,default:!1},center:{type:Array,default:null},zoom:{type:Number,default:11},height:{type:String,default:"360px"}},setup(M){const v=M,g=m(null),c=m(null),w=m([]),o=m(null),n=m(null),l="3ec184bed1a63816a5a24592304c17bf",A="23abf66fb7d1a21be0586c03024e4f87",y=!!l,b=a=>{if(v.center&&v.center.length===2)return v.center;if(!a.length)return[116.397428,39.90923];const p=a.reduce((I,U)=>{const h=U.coords||U,x=Array.isArray(h)?h[0]:h.lng,L=Array.isArray(h)?h[1]:h.lat;return[I[0]+x,I[1]+L]},[0,0]);return[p[0]/a.length,p[1]/a.length]},e=a=>a?Array.isArray(a)?a:[a.lng,a.lat]:null,s=()=>{w.value.forEach(a=>a.setMap(null)),w.value=[]},t=()=>{o.value&&(o.value.setMap(null),o.value=null)},i=()=>{if(!n.value||!c.value)return;s();const a=v.points||[];a.length&&(w.value=a.map((p,I)=>{const U=p.coords||p,h=e(U);if(!h)return null;const x=p.order??I+1,L=v.showIndex?`<div style="width:26px;height:26px;border-radius:50%;background:#0b6b6f;color:#fff;font-size:12px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 10px rgba(11,107,111,0.35);">${x}</div>`:void 0;return new n.value.Marker({position:h,title:p.title||p.name||"",content:L,offset:L?new n.value.Pixel(-13,-13):void 0})}).filter(Boolean),c.value.add(w.value))},u=()=>{if(!n.value||!c.value)return;t();const a=(v.path||[]).map(p=>e(p)).filter(Boolean);a.length<2||(o.value=new n.value.Polyline({path:a,strokeColor:"#0b6b6f",strokeOpacity:.85,strokeWeight:5,strokeStyle:"solid"}),c.value.add(o.value))},f=()=>{const a=[];w.value.length&&a.push(...w.value),o.value&&a.push(o.value),a.length?c.value.setFitView(a,!0,[40,40,40,40]):c.value.setCenter(b(v.points||[]))},d=()=>{i(),u(),f()};return S(async()=>{!y||!g.value||(window._AMapSecurityConfig={securityJsCode:A},n.value=await K.load({key:l,version:"2.0",plugins:["AMap.Scale","AMap.ToolBar","AMap.Geolocation"]}),c.value=new n.value.Map(g.value,{zoom:v.zoom,center:b(v.points||[]),mapStyle:"amap://styles/macaron"}),c.value.addControl(new n.value.Scale),c.value.addControl(new n.value.ToolBar({position:"RB"})),d())}),j(()=>[v.points,v.path],()=>d(),{deep:!0}),V(()=>{s(),t(),c.value&&c.value.destroy()}),(a,p)=>(P(),k("div",{class:"map-wrapper",style:O({height:M.height})},[z(y)?(P(),k("div",{key:0,ref_key:"mapEl",ref:g,class:"map-canvas"},null,512)):(P(),k("div",R,[...p[0]||(p[0]=[E("p",null,"尚未配置高德地图 Key",-1),E("span",null,"请在 .env.local 设置 `VITE_AMAP_KEY` 与 `VITE_AMAP_SECURITY`",-1)])]))],4))}},F=C(W,[["__scopeId","data-v-8fc9c187"]]);export{F as A};
