import{_ as ee,r,c as p,x as te,a as v,b as e,s as le,t as d,h as I,j as T,v as se,k as oe,F as C,f as y,u as M,d as b,w as ne,e as ae,o as i,y as O,n as F,i as L}from"./index-CHByyoby.js";import{R as D}from"./RouteCard-D1gWP8sr.js";import{A as E}from"./AMapView-DnCWBAsZ.js";import{s as w,r as S}from"./demo-D30EAGrZ.js";const ie={class:"page"},ue={class:"page-header"},re={class:"header-actions"},ve={class:"save-hint"},de=["disabled"],ce={class:"builder"},pe={class:"builder-form"},_e={class:"selected-panel"},he={class:"selected-head"},me={class:"selected-list"},ge=["onDragstart","onDragover","onDrop"],fe={class:"order-pill"},be={class:"selected-info"},we={class:"order-actions"},ke=["onClick"],Ce=["onClick"],ye=["onClick"],De={class:"builder-list"},Se={class:"builder-items"},Re=["onClick"],$e={class:"builder-preview"},xe={class:"preview-panel"},Ie={key:0,class:"section saved-section"},Be={class:"saved-grid"},Pe={class:"section"},Ve={class:"section-head"},Ae={class:"route-showcase"},Ne={class:"route-grid"},Te={class:"route-preview"},Me={class:"preview-head"},Oe={__name:"Routes",setup(Fe){const _=r("我的新路线"),h=r("舒缓"),o=r(w.slice(0,3).map(l=>l.id)),k=r(""),m=p(()=>o.value.map((l,t)=>{const a=w.find(s=>s.id===l);return a?{...a,order:t+1}:null}).filter(Boolean)),R=p(()=>({title:_.value||"未命名路线",distance:`${(o.value.length*1.2+1.5).toFixed(1)} km`,duration:`${o.value.length*12+18} min`,tone:h.value,stops:m.value.map(l=>l.title)})),J=p(()=>m.value.map(l=>l.coords)),$=r(S[0]?.id||""),x=p(()=>S.find(l=>l.id===$.value)||S[0]),B=p(()=>(x.value?.pointIds||[]).map((t,a)=>{const s=w.find(n=>n.id===t);return s?{...s,order:a+1}:null}).filter(Boolean)),U=p(()=>B.value.map(l=>l.coords)),P=l=>{o.value.includes(l)?o.value=o.value.filter(t=>t!==l):o.value=[...o.value,l]},V=(l,t)=>{const a=l+t;if(a<0||a>=o.value.length)return;const s=[...o.value],[n]=s.splice(l,1);s.splice(a,0,n),o.value=s},u=r(null),g=r(null),j=l=>{u.value=l},q=l=>{g.value=l},z=l=>{if(u.value===null||u.value===l){u.value=null,g.value=null;return}const t=[...o.value],[a]=t.splice(u.value,1);t.splice(l,0,a),o.value=t,u.value=null,g.value=null},H=()=>{u.value=null,g.value=null},G=l=>{$.value=l.id},{state:K}=te(),A=p(()=>!K.user),c=r([]),Q=()=>{try{const l=JSON.parse(localStorage.getItem("csm_routes")||"[]");c.value=Array.isArray(l)?l:[]}catch{c.value=[]}},W=()=>{localStorage.setItem("csm_routes",JSON.stringify(c.value))},X=()=>{if(A.value){k.value="请先登录后再保存路线。";return}const l={id:`custom-${Date.now()}`,title:_.value||"未命名路线",tone:h.value,stops:m.value.map(t=>t.title),pointIds:o.value,distance:R.value.distance,duration:R.value.duration,createdAt:new Date().toISOString()};c.value=[l,...c.value].slice(0,6),W(),k.value="已保存到我的路线。",setTimeout(()=>{k.value=""},2e3)},Y=l=>{_.value=l.title,h.value=l.tone,o.value=[...l.pointIds]},Z=()=>{o.value=[]},N=()=>{_.value="我的新路线",h.value="舒缓",o.value=w.slice(0,3).map(l=>l.id)};return Q(),(l,t)=>{const a=ae("RouterLink");return i(),v("div",ie,[e("header",ue,[t[2]||(t[2]=e("div",null,[e("h1",null,"声音路线工作台"),e("p",null,"拖拽或勾选声音点位，快速生成你的主题路线。")],-1)),e("div",re,[e("span",ve,d(k.value),1),e("button",{class:"ghost-button",onClick:Z},"清空"),e("button",{class:"ghost-button",onClick:N},"重置"),e("button",{class:"primary-button",disabled:A.value,onClick:X}," 保存路线 ",8,de)])]),e("section",ce,[e("div",pe,[e("label",null,[t[3]||(t[3]=I(" 路线标题 ",-1)),T(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),type:"text"},null,512),[[se,_.value]])]),e("label",null,[t[5]||(t[5]=I(" 路线氛围 ",-1)),T(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>h.value=s)},[...t[4]||(t[4]=[e("option",null,"舒缓",-1),e("option",null,"热闹",-1),e("option",null,"清醒",-1),e("option",null,"浪漫",-1)])],512),[[oe,h.value]])]),e("div",_e,[e("div",he,[t[6]||(t[6]=e("p",null,"已选点位",-1)),e("span",null,d(m.value.length)+" 个",1)]),e("ul",me,[(i(!0),v(C,null,y(m.value,(s,n)=>(i(),v("li",{key:s.id,draggable:"true",class:F({dragging:u.value===n,over:g.value===n&&u.value!==n}),onDragstart:f=>j(n),onDragover:O(f=>q(n),["prevent"]),onDrop:O(f=>z(n),["prevent"]),onDragend:H},[t[7]||(t[7]=e("span",{class:"drag-handle",title:"拖拽排序"},"⠿",-1)),e("span",fe,d(n+1),1),e("div",be,[e("strong",null,d(s.title),1),e("small",null,d(s.city),1)]),e("div",we,[e("button",{class:"text-button",onClick:f=>V(n,-1)},"上移",8,ke),e("button",{class:"text-button",onClick:f=>V(n,1)},"下移",8,Ce),e("button",{class:"text-button",onClick:f=>P(s.id)},"移除",8,ye)])],42,ge))),128))])]),e("div",De,[t[8]||(t[8]=e("p",null,"可选声音点位",-1)),e("div",Se,[(i(!0),v(C,null,y(M(w),s=>(i(),v("button",{key:s.id,class:F(["builder-item",{active:o.value.includes(s.id)}]),onClick:n=>P(s.id)},[e("span",null,d(s.title),1),e("small",null,d(s.city),1)],10,Re))),128))])])]),e("div",$e,[e("div",xe,[t[9]||(t[9]=e("div",{class:"preview-head"},[e("h3",null,"路线预览"),e("p",null,"拖拽已选点位，实时生成轨迹。")],-1)),b(E,{points:m.value,path:J.value,"show-index":!0,height:"260px"},null,8,["points","path"])]),b(D,{route:R.value,"show-action":!1},null,8,["route"])])]),c.value.length?(i(),v("section",Ie,[t[10]||(t[10]=e("div",{class:"section-head"},[e("div",null,[e("h2",null,"我的路线"),e("p",null,"保存的路线可一键导入编辑器。")])],-1)),e("div",Be,[(i(!0),v(C,null,y(c.value,s=>(i(),L(D,{key:s.id,route:s,"show-action":!1,onClick:n=>Y(s)},null,8,["route","onClick"]))),128)),e("button",{class:"ghost-button full",onClick:N},"新建路线")])])):le("",!0),e("section",Pe,[e("div",Ve,[t[12]||(t[12]=e("div",null,[e("h2",null,"热门路线"),e("p",null,"来自社区创作者的精选路线模板。")],-1)),b(a,{class:"ghost-button",to:"/routes"},{default:ne(()=>[...t[11]||(t[11]=[I("浏览全部路线",-1)])]),_:1})]),e("div",Ae,[e("div",Ne,[(i(!0),v(C,null,y(M(S),s=>(i(),L(D,{key:s.id,route:s,active:$.value===s.id,onPreview:n=>G(s)},null,8,["route","active","onPreview"]))),128))]),e("aside",Te,[e("div",Me,[t[13]||(t[13]=e("h3",null,"线路预览",-1)),e("p",null,"当前："+d(x.value?.title||"未选择"),1)]),b(E,{points:B.value,path:U.value,"show-index":!0,height:"240px"},null,8,["points","path"]),b(D,{route:x.value,"show-action":!1},null,8,["route"])])])])])}}},je=ee(Oe,[["__scopeId","data-v-3aaae2b5"]]);export{je as default};
