import{q as T,_ as C,c as d,e as w,a as x,o as c,b as n,t as o,i as L,s as b,u as I,w as B,h as S,n as E,m}from"./index-CHByyoby.js";const s=new Audio,e=T({currentId:"",currentUrl:"",isPlaying:!1,currentTime:0,duration:0});let y=!1;const f=()=>{e.currentTime=s.currentTime||0,e.duration=Number.isFinite(s.duration)?s.duration:0},g=()=>{y||(y=!0,s.preload="metadata",s.addEventListener("timeupdate",f),s.addEventListener("loadedmetadata",f),s.addEventListener("ended",()=>{e.isPlaying=!1}))},N=(t,a)=>{a&&(e.currentUrl!==a?(e.currentUrl=a,e.currentId=t,e.currentTime=0,e.duration=0,s.src=a,s.load()):e.currentId=t)},v=async(t,a)=>{if(a){g(),N(t,a);try{await s.play(),e.isPlaying=!0}catch{e.isPlaying=!1}}},p=()=>{s.pause(),e.isPlaying=!1},z=(t,a)=>{e.currentId===t&&e.isPlaying?p():v(t,a)},U=t=>{e.duration&&(s.currentTime=Math.min(Math.max(t,0),1)*e.duration)};function V(){return g(),{state:e,play:v,pause:p,toggle:z,seek:U}}const $={class:"sound-top"},q={class:"sound-tag"},A={class:"sound-duration"},M={class:"sound-location"},R={class:"sound-mood"},j={class:"sound-meta"},D={class:"sound-actions"},F={class:"progress-bar"},O={__name:"SoundCard",props:{sound:{type:Object,required:!0},showLink:{type:Boolean,default:!0}},setup(t){const a=t,{state:i,toggle:h}=V(),r=d(()=>i.currentId===a.sound.id),l=d(()=>r.value&&i.isPlaying),k=d(()=>!r.value||!i.duration?0:i.currentTime/i.duration*100);return(G,u)=>{const P=w("RouterLink");return c(),x("article",{class:"sound-card",style:m({"--accent":t.sound.color})},[n("div",$,[n("span",q,o(t.sound.tag),1),n("span",A,o(t.sound.duration),1)]),n("h3",null,o(t.sound.title),1),n("p",M,o(t.sound.location),1),n("p",R,o(t.sound.mood),1),n("div",j,[n("span",null,"热度 "+o(t.sound.heat),1),n("span",null,o(t.sound.city),1)]),n("div",D,[n("button",{class:"text-button",onClick:u[0]||(u[0]=H=>I(h)(t.sound.id,t.sound.audio))},o(l.value?"暂停":"试听"),1),t.showLink?(c(),L(P,{key:0,class:"detail-link",to:`/sounds/${t.sound.id}`},{default:B(()=>[...u[1]||(u[1]=[S(" 详情 ",-1)])]),_:1},8,["to"])):b("",!0),n("div",{class:E(["sound-progress",{active:l.value}])},[...u[2]||(u[2]=[n("span",null,null,-1),n("span",null,null,-1),n("span",null,null,-1),n("span",null,null,-1),n("span",null,null,-1)])],2)]),n("div",F,[n("span",{style:m({width:`${k.value}%`})},null,4)])],4)}}},K=C(O,[["__scopeId","data-v-6e6023d4"]]);export{K as S,V as u};
