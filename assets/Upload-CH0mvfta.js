import{_ as O,q as D,r as d,x as q,c as _,B as K,a as c,b as e,i as P,w as M,y as H,s as x,d as W,e as G,h as i,t as n,j as f,v as g,k as J,m as Q,p as X,o as m}from"./index-kLhkg_TB.js";const Y={class:"page"},Z={class:"page-header"},z={class:"page-actions"},ee={key:1,class:"ghost-button"},te={class:"upload-layout"},le={key:0,class:"login-alert"},oe={class:"file-field"},ae={key:1,class:"file-meta"},ne={key:2,class:"status warn"},se=["disabled"],ue={key:3,class:"status"},ie={class:"preview"},re={class:"preview-card"},de={class:"preview-meta"},ve={class:"preview-tag"},pe={class:"preview-mood"},me={class:"preview-story"},ce={class:"audio-player"},fe={class:"player-bar"},ye={class:"player-meta"},be=["value"],ge={__name:"Upload",setup(Le){const l=D({title:"",tag:"自然",city:"",location:"",mood:"",story:""}),y=d(""),b=d(null),u=d(""),v=d(0),L=d(0),p=d(!1),r=d(""),R=d(null),o=new Audio;X();const{state:A}=q(),k=_(()=>!A.user),N=()=>{if(k.value){y.value="请先登录后再保存。";return}y.value="已保存为草稿，可继续补充后发布。",setTimeout(()=>{y.value=""},3e3)},E=a=>{const t=Math.floor((a||0)/60),w=Math.floor((a||0)%60);return`${t.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`},T=a=>a?a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(1)} KB`:`${(a/1024/1024).toFixed(1)} MB`:"0 KB",S=_(()=>E(v.value)),$=_(()=>E(L.value)),V=_(()=>v.value?L.value/v.value*100:0),B=()=>{o.pause(),p.value=!1,L.value=0,v.value=0,r.value="",u.value&&URL.revokeObjectURL(u.value),u.value="",b.value=null,R.value&&(R.value.value="")},U=()=>{L.value=o.currentTime||0,v.value=Number.isFinite(o.duration)?o.duration:0},C=()=>{p.value=!1},h=()=>{r.value="音频加载失败，请尝试其他格式。"},j=a=>{const t=a.target.files?.[0];if(!t){B();return}if(!t.type.startsWith("audio/")){r.value="请选择音频文件（mp3/wav/aac 等）。",B();return}r.value="",b.value=t,u.value&&URL.revokeObjectURL(u.value),u.value=URL.createObjectURL(t),o.src=u.value,o.load()},F=async()=>{if(!u.value){r.value="请先选择音频文件。";return}if(p.value){o.pause(),p.value=!1;return}try{await o.play(),p.value=!0}catch{p.value=!1,r.value="浏览器阻止自动播放，请点击按钮再次播放。"}},I=a=>{const t=Number(a.target.value)/100;v.value&&(o.currentTime=v.value*t)};return o.addEventListener("timeupdate",U),o.addEventListener("loadedmetadata",U),o.addEventListener("ended",C),o.addEventListener("error",h),K(()=>{o.removeEventListener("timeupdate",U),o.removeEventListener("loadedmetadata",U),o.removeEventListener("ended",C),o.removeEventListener("error",h),u.value&&URL.revokeObjectURL(u.value)}),(a,t)=>{const w=G("RouterLink");return m(),c("div",Y,[e("header",Z,[t[7]||(t[7]=e("div",null,[e("h1",null,"上传声音"),e("p",null,"补充地点、故事与情绪，让声音更有记忆点。")],-1)),e("div",z,[k.value?(m(),P(w,{key:0,class:"ghost-button",to:"/login"},{default:M(()=>[...t[6]||(t[6]=[i("登录后上传",-1)])]),_:1})):(m(),c("button",ee,"查看上传指南"))])]),e("section",te,[e("form",{class:"upload-form",onSubmit:H(N,["prevent"])},[k.value?(m(),c("div",le,[t[9]||(t[9]=e("p",null,"登录后可上传声音并保存草稿。",-1)),W(w,{class:"text-button",to:"/login"},{default:M(()=>[...t[8]||(t[8]=[i("去登录",-1)])]),_:1})])):x("",!0),e("label",oe,[t[10]||(t[10]=i(" 音频文件 ",-1)),e("input",{ref_key:"fileInputRef",ref:R,type:"file",accept:"audio/*",onChange:j},null,544),t[11]||(t[11]=e("span",{class:"file-hint"},"建议 10MB 以内，支持 mp3/wav/aac。",-1))]),b.value?(m(),c("div",ae,[e("div",null,[e("strong",null,n(b.value.name),1),e("p",null,n(T(b.value.size))+" · "+n(S.value),1)]),e("button",{type:"button",class:"text-button",onClick:B},"移除")])):x("",!0),r.value?(m(),c("p",ne,n(r.value),1)):x("",!0),e("label",null,[t[12]||(t[12]=i(" 声音标题 ",-1)),f(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.title=s),type:"text",placeholder:"比如：河岸夜风"},null,512),[[g,l.title]])]),e("label",null,[t[14]||(t[14]=i(" 标签 ",-1)),f(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.tag=s)},[...t[13]||(t[13]=[e("option",null,"自然",-1),e("option",null,"交通",-1),e("option",null,"人声",-1),e("option",null,"音乐",-1),e("option",null,"环境",-1)])],512),[[J,l.tag]])]),e("label",null,[t[15]||(t[15]=i(" 城市 ",-1)),f(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.city=s),type:"text",placeholder:"例如：杭州"},null,512),[[g,l.city]])]),e("label",null,[t[16]||(t[16]=i(" 具体地点 ",-1)),f(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.location=s),type:"text",placeholder:"如：拱宸桥河岸"},null,512),[[g,l.location]])]),e("label",null,[t[17]||(t[17]=i(" 情绪标签 ",-1)),f(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>l.mood=s),type:"text",placeholder:"安静、轻快、温暖…"},null,512),[[g,l.mood]])]),e("label",null,[t[18]||(t[18]=i(" 故事描述 ",-1)),f(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=s=>l.story=s),rows:"5",placeholder:"这段声音背后的故事"},null,512),[[g,l.story]])]),e("button",{class:"primary-button full",type:"submit",disabled:k.value}," 保存为草稿 ",8,se),y.value?(m(),c("p",ue,n(y.value),1)):x("",!0)],32),e("div",ie,[e("div",re,[t[19]||(t[19]=e("p",{class:"preview-title"},"声音预览",-1)),e("h3",null,n(l.title||"未命名声音"),1),e("p",de,n(l.city||"城市")+" · "+n(l.location||"地点"),1),e("span",ve,n(l.tag),1),e("p",pe,n(l.mood||"情绪标签待补充"),1),e("p",me,n(l.story||"故事描述待补充"),1),e("div",ce,[e("button",{class:"primary-button ghost",type:"button",onClick:F},n(p.value?"暂停":"试听预览"),1),e("div",fe,[e("span",{style:Q({width:`${V.value}%`})},null,4)]),e("div",ye,[e("span",null,n($.value),1),e("input",{type:"range",min:"0",max:"100",value:V.value,onInput:I},null,40,be),e("span",null,n(S.value),1)])])]),t[20]||(t[20]=e("div",{class:"tips"},[e("h4",null,"上传小贴士"),e("ul",null,[e("li",null,"录音时避开强风，尽量靠近声音源。"),e("li",null,"描述中写下“时间 + 场景”，更利于检索。"),e("li",null,"添加照片或小故事，声音会更有温度。")])],-1))])])])}}},Ue=O(ge,[["__scopeId","data-v-eb653a69"]]);export{Ue as default};
